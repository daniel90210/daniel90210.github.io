<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #121212;
            overflow: hidden;
        }

        .chess-container {
            display: flex;
            justify-content: center;
            align-items: center;
            max-width: 80vh;
            width: 100%;
        }

        .chessboard {
            display: grid;
            grid-template-columns: repeat(8, min(10vw, 7vh));
            grid-template-rows: repeat(8, min(10vw, 7vh));
            gap: 0;
            box-shadow: 0px 0px 10px rgba(255, 255, 255, 0.1);
        }

        .square {
            width: min(10vw, 7vh);
            height: min(10vw, 7vh);
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .white {
            background-color: #FFFED8;
        }

        .black {
            background-color: #51B02B;
        }

        .piece {
            width: 90%;
            height: 90%;
            background-size: cover;
            background-position: center;
            cursor: pointer;
        }

        .highlight {
            background-color: rgba(255, 0, 0, 0.4);
        }
    </style>
</head>
<body>
    <div class="chess-container">
        <div id="chessboard" class="chessboard"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/stockfish/11.0.0/stockfish.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const boardElement = document.getElementById('chessboard');

            const initialBoard = [
                ['bc', 'bkn', 'bb', 'bq', 'bk', 'bb', 'bkn', 'bc'],
                ['bp', 'bp', 'bp', 'bp', 'bp', 'bp', 'bp', 'bp'],
                ['--', '--', '--', '--', '--', '--', '--', '--'],
                ['--', '--', '--', '--', '--', '--', '--', '--'],
                ['--', '--', '--', '--', '--', '--', '--', '--'],
                ['--', '--', '--', '--', '--', '--', '--', '--'],
                ['wp', 'wp', 'wp', 'wp', 'wp', 'wp', 'wp', 'wp'],
                ['wc', 'wkn', 'wb', 'wq', 'wk', 'wb', 'wkn', 'wc']
            ];

            const pieceImages = {
                'wp': 'pieces/wp.PNG',
                'wkn': 'pieces/wkn.PNG',
                'wb': 'pieces/wb.PNG',
                'wq': 'pieces/wq.PNG',
                'wk': 'pieces/wk.PNG',
                'wc': 'pieces/wc.PNG',
                'bp': 'pieces/bp.PNG',
                'bkn': 'pieces/bkn.PNG',
                'bb': 'pieces/bb.PNG',
                'bq': 'pieces/bq.PNG',
                'bk': 'pieces/bk.PNG',
                'bc': 'pieces/bc.PNG',
                '--': ''
            };

            let selectedPiece = null;
            let validMoves = [];

            function generateFEN() {
                let fen = '';
                for (let row = 0; row < 8; row++) {
                    let emptyCount = 0;
                    for (let col = 0; col < 8; col++) {
                        const piece = initialBoard[row][col];

                        if (piece === '--') {
                            emptyCount++;
                        } else {
                            if (emptyCount > 0) {
                                fen += emptyCount;
                                emptyCount = 0;
                            }
                            fen += piece;
                        }
                    }

                    if (emptyCount > 0) {
                        fen += emptyCount;
                    }

                    if (row < 7) {
                        fen += '/';
                    }
                }
                fen += ' w KQkq - 0 1';  // Example for the starting position
                return fen;
            }

            function createBoard() {
                boardElement.innerHTML = '';
                for (let row = 0; row < 8; row++) {
                    for (let col = 0; col < 8; col++) {
                        const square = document.createElement('div');
                        const piece = initialBoard[row][col];
                        square.classList.add('square');
                        square.classList.add((row + col) % 2 === 0 ? 'white' : 'black');

                        if (piece !== '--') {
                            const img = document.createElement('img');
                            img.src = pieceImages[piece];
                            img.alt = piece;
                            img.classList.add('piece');
                            img.dataset.row = row;
                            img.dataset.col = col;
                            img.addEventListener('click', selectPiece);
                            square.appendChild(img);
                        }

                        boardElement.appendChild(square);
                    }
                }
            }

            function selectPiece(event) {
                const img = event.target;
                const row = parseInt(img.dataset.row);
                const col = parseInt(img.dataset.col);
                const piece = initialBoard[row][col];

                if (selectedPiece) {
                    movePiece(row, col);
                } else {
                    highlightValidMoves(row, col);
                }
            }

            function highlightValidMoves(row, col) {
                // Clear previous highlights
                validMoves = [];
                const piece = initialBoard[row][col];

                if (piece === '--') return; // Don't allow selection of empty squares

                // Get valid moves for the piece
                validMoves = getValidMoves(row, col, piece);

                // Highlight valid moves
                validMoves.forEach(move => {
                    const square = boardElement.children[move.row * 8 + move.col];
                    square.classList.add('highlight');
                });
                selectedPiece = { row, col };
            }

            function getValidMoves(row, col, piece) {
                const moves = [];
                switch (piece[1]) {
                    case 'p':  // Pawn
                        const direction = piece[0] === 'w' ? -1 : 1;
                        if (initialBoard[row + direction] && initialBoard[row + direction][col] === '--') {
                            moves.push({ row: row + direction, col });
                        }
                        break;
                    case 'r':  // Rook
                        moves.push(...getStraightLineMoves(row, col));
                        break;
                    case 'n':  // Knight
                        moves.push(...getKnightMoves(row, col));
                        break;
                    case 'b':  // Bishop
                        moves.push(...getDiagonalMoves(row, col));
                        break;
                    case 'q':  // Queen
                        moves.push(...getStraightLineMoves(row, col));
                        moves.push(...getDiagonalMoves(row, col));
                        break;
                    case 'k':  // King
                        moves.push(...getKingMoves(row, col));
                        break;
                }
                return moves;
            }

            function getStraightLineMoves(row, col) {
                const directions = [
                    { r: 1, c: 0 }, { r: -1, c: 0 }, { r: 0, c: 1 }, { r: 0, c: -1 }
                ];
                return directions.flatMap(d => {
                    const moves = [];
                    let r = row + d.r;
                    let c = col + d.c;
                    while (r >= 0 && r < 8 && c >= 0 && c < 8) {
                        if (initialBoard[r][c] === '--') {
                            moves.push({ row: r, col: c });
                        } else {
                            break;
                        }
                        r += d.r;
                        c += d.c;
                    }
                    return moves;
                });
            }

            function getDiagonalMoves(row, col) {
                const directions = [
                    { r: 1, c: 1 }, { r: 1, c: -1 }, { r: -1, c: 1 }, { r: -1, c: -1 }
                ];
                return directions.flatMap(d => {
                    const moves = [];
                    let r = row + d.r;
                    let c = col + d.c;
                    while (r >= 0 && r < 8 && c >= 0 && c < 8) {
                        if (initialBoard[r][c] === '--') {
                            moves.push({ row: r, col: c });
                        } else {
                            break;
                        }
                        r += d.r;
                        c += d.c;
                    }
                    return moves;
                });
            }

            function getKnightMoves(row, col) {
                const knightMoves = [
                    { r: 2, c: 1 }, { r: 2, c: -1 }, { r: -2, c: 1 }, { r: -2, c: -1 },
                    { r: 1, c: 2 }, { r: 1, c: -2 }, { r: -1, c: 2 }, { r: -1, c: -2 }
                ];
                return knightMoves.map(d => ({ row: row + d.r, col: col + d.c }))
                    .filter(move => move.row >= 0 && move.row < 8 && move.col >= 0 && move.col < 8);
            }

            function getKingMoves(row, col) {
                const kingMoves = [
                    { r: 1, c: 0 }, { r: -1, c: 0 }, { r: 0, c: 1 }, { r: 0, c: -1 },
                    { r: 1, c: 1 }, { r: 1, c: -1 }, { r: -1, c: 1 }, { r: -1, c: -1 }
                ];
                return kingMoves.map(d => ({ row: row + d.r, col: col + d.c }))
                    .filter(move => move.row >= 0 && move.row < 8 && move.col >= 0 && move.col < 8);
            }

            function movePiece(row, col) {
                const { row: fromRow, col: fromCol } = selectedPiece;
                const piece = initialBoard[fromRow][fromCol];

                if (validMoves.some(move => move.row === row && move.col === col)) {
                    initialBoard[row][col] = piece;
                    initialBoard[fromRow][fromCol] = '--';

                    createBoard();  // Recreate the board
                    selectedPiece = null;
                    validMoves = [];
                } else {
                    selectedPiece = null;
                    validMoves = [];
                    createBoard();
                }
            }

            createBoard(); // Initial board render
        });
    </script>
</body>
</html>
